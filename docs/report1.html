<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bayan Abou Rekbeh">
<meta name="dcterms.date" content="2025-10-12">

<title>Benchmarking the Standard Genetic Code (SGC)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="report1_files/libs/clipboard/clipboard.min.js"></script>
<script src="report1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="report1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="report1_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="report1_files/libs/quarto-html/popper.min.js"></script>
<script src="report1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report1_files/libs/quarto-html/anchor.min.js"></script>
<link href="report1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report1_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report1_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">2</span> Limitations</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method"><span class="header-section-number">3</span> Method</a></li>
  <li><a href="#the-experiment" id="toc-the-experiment" class="nav-link" data-scroll-target="#the-experiment"><span class="header-section-number">4</span> The Experiment</a>
  <ul class="collapse">
  <li><a href="#sgc-quality-score" id="toc-sgc-quality-score" class="nav-link" data-scroll-target="#sgc-quality-score"><span class="header-section-number">4.1</span> SGC Quality Score</a>
  <ul class="collapse">
  <li><a href="#amino-acid-similarity-function-aasim" id="toc-amino-acid-similarity-function-aasim" class="nav-link" data-scroll-target="#amino-acid-similarity-function-aasim"><span class="header-section-number">4.1.1</span> Amino-Acid Similarity Function <code>aaSim()</code>:</a></li>
  <li><a href="#load-the-sgc-and-define-helpers" id="toc-load-the-sgc-and-define-helpers" class="nav-link" data-scroll-target="#load-the-sgc-and-define-helpers"><span class="header-section-number">4.1.2</span> Load the SGC and Define Helpers</a></li>
  <li><a href="#compute-the-sgc-quality-score" id="toc-compute-the-sgc-quality-score" class="nav-link" data-scroll-target="#compute-the-sgc-quality-score"><span class="header-section-number">4.1.3</span> Compute the SGC Quality Score</a></li>
  </ul></li>
  <li><a href="#random-genetic-codes" id="toc-random-genetic-codes" class="nav-link" data-scroll-target="#random-genetic-codes"><span class="header-section-number">4.2</span> Random Genetic Codes</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">4.2.1</span> Setup</a></li>
  <li><a href="#random-code-generator" id="toc-random-code-generator" class="nav-link" data-scroll-target="#random-code-generator"><span class="header-section-number">4.2.2</span> Random-code Generator</a></li>
  <li><a href="#save-results" id="toc-save-results" class="nav-link" data-scroll-target="#save-results"><span class="header-section-number">4.2.3</span> Save Results</a></li>
  </ul></li>
  <li><a href="#random-code-quality-distribution" id="toc-random-code-quality-distribution" class="nav-link" data-scroll-target="#random-code-quality-distribution"><span class="header-section-number">4.3</span> Random-code Quality Distribution</a>
  <ul class="collapse">
  <li><a href="#load-results" id="toc-load-results" class="nav-link" data-scroll-target="#load-results"><span class="header-section-number">4.3.1</span> Load Results</a></li>
  <li><a href="#plot-histogram" id="toc-plot-histogram" class="nav-link" data-scroll-target="#plot-histogram"><span class="header-section-number">4.3.2</span> Plot Histogram</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">5</span> Results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  <li><a href="#a-global-optimum" id="toc-a-global-optimum" class="nav-link" data-scroll-target="#a-global-optimum"><span class="header-section-number">7</span> A Global Optimum</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">8</span> References</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">9</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#experience-preparing-the-report" id="toc-experience-preparing-the-report" class="nav-link" data-scroll-target="#experience-preparing-the-report"><span class="header-section-number">9.1</span> Experience Preparing the Report</a></li>
  <li><a href="#role-of-ai-assistant---chatgpt-5-thinking-mode" id="toc-role-of-ai-assistant---chatgpt-5-thinking-mode" class="nav-link" data-scroll-target="#role-of-ai-assistant---chatgpt-5-thinking-mode"><span class="header-section-number">9.2</span> Role of AI Assistant - ChatGPT 5 thinking mode</a></li>
  <li><a href="#self-assessment" id="toc-self-assessment" class="nav-link" data-scroll-target="#self-assessment"><span class="header-section-number">9.3</span> Self-Assessment</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Benchmarking the Standard Genetic Code (SGC)</h1>
<p class="subtitle lead">Point-Mutation Tolerance via Amino-Acid Similarity</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bayan Abou Rekbeh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Abstract</h1>
<p>This report evaluates whether the SGC is unusually tolerant to point mutations. The analysis measures how similar the encoded amino acids remain after every possible single-base substitution. The SGC’s score was compared to 10,000 randomly generated genetic codes that are valid biologically. The SGC achieved a substantially lower (better) score than all random alternatives, suggesting that its structure is highly non-random and reflects evolutionary optimization to minimize the effects of point mutations.</p>
</section>
<section id="limitations" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Limitations</h1>
<ul>
<li><em>Amino Acid Similarity:</em> <code>aaSim()</code> approximates biochemical similarity of amino acids and may not capture all functional relationships</li>
<li><em>Genetic Code Constraints:</em> Random codes preserve SGC degeneracy</li>
<li><em>Scope:</em> No modeling of codon usage or protein context</li>
</ul>
</section>
<section id="method" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Method</h1>
<p>The SGC was evaluated by comparing amino acid similarities for all 64 codons and their nine single-base neighbors. Ten thousand random genetic codes were generated and evaluated with the same method and saved for analysis. Summary statistics and histogram were produced to compare SGC’s performance against random codes.</p>
</section>
<section id="the-experiment" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> The Experiment</h1>
<section id="sgc-quality-score" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sgc-quality-score"><span class="header-section-number">4.1</span> SGC Quality Score</h2>
<p>We measure how tolerant the SGC is to point-mutations by comparing how similar amino acids remain after each possible point mutation</p>
<section id="amino-acid-similarity-function-aasim" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="amino-acid-similarity-function-aasim"><span class="header-section-number">4.1.1</span> Amino-Acid Similarity Function <code>aaSim()</code>:</h3>
<p><code>aaSim()</code> is being rebuild using CSB195 course material (Stepie, 2025). It measures how similar two amino acids are by computing their Euclidean distance in a multi-dimensional “feature space” built from biochemical properties such as charge, polarity, and volume.</p>
<p>Smaller distance → greater similarity</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct the aaSim() function</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>aaSimConstructor <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  spaceFile <span class="ot">&lt;-</span> <span class="st">"dat/aaFeatureSpace.4.1.Rds"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  stopDistFactor <span class="ot">&lt;-</span> <span class="fl">1.5</span>  <span class="co"># distance multiplier for stop codon</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download feature space if missing</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(spaceFile)) {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    ghUrl <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/hyginn/CSB195/main/"</span>, spaceFile)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(<span class="at">url =</span> ghUrl, <span class="at">destfile =</span> spaceFile, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    aaSpace <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(spaceFile)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    nAA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(aaSpace)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    aaDist <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nAA, <span class="at">ncol =</span> nAA)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute Euclidean distances for all amino-acid pairs</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(nAA)) {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(nAA)) {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      aaDist[i, j] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((aaSpace[i, ] <span class="sc">-</span> aaSpace[j, ])<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add stop codon distances</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  maxD <span class="ot">&lt;-</span> <span class="fu">max</span>(aaDist)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  stopD <span class="ot">&lt;-</span> stopDistFactor <span class="sc">*</span> maxD</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  aaDist <span class="ot">&lt;-</span> <span class="fu">rbind</span>(aaDist, stopD)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  aaDist <span class="ot">&lt;-</span> <span class="fu">cbind</span>(aaDist, <span class="fu">c</span>(<span class="fu">rep</span>(stopD, nAA), <span class="dv">0</span>))</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(aaDist) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(aaSpace), <span class="st">"*"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(aaDist) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(aaSpace), <span class="st">"*"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  myFun <span class="ot">&lt;-</span> <span class="cf">function</span>(a1, a2) {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(aaDist[a1, a2])</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(myFun, <span class="st">"AADMAT"</span>) <span class="ot">&lt;-</span> aaDist</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(myFun, <span class="st">"alphabet"</span>) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(aaDist)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(myFun)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create aaSim() from the constructor</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>aaSim <span class="ot">&lt;-</span> <span class="fu">aaSimConstructor</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="load-the-sgc-and-define-helpers" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="load-the-sgc-and-define-helpers"><span class="header-section-number">4.1.2</span> Load the SGC and Define Helpers</h3>
<p>The Standard Genetic Code (SGC) was obtained from the National Center for Biotechnology Information (NCBI, 2024).</p>
<p>We load <code>dat/SGC.csv</code>, convert codons to RNA alphabet (use “U” not “T”), and then build small helper functions:</p>
<p><code>translate()</code> maps codons to amino acids</p>
<p><code>neighbor9()</code> lists the nine possible single-base neighbors for each codon</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters (no magic numbers)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>datDir        <span class="ot">&lt;-</span> <span class="st">"dat"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sgcFile       <span class="ot">&lt;-</span> <span class="fu">file.path</span>(datDir, <span class="st">"SGC.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>bases         <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"U"</span>,<span class="st">"G"</span>,<span class="st">"C"</span>)     <span class="co"># RNA alphabet</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>expectedScore <span class="ot">&lt;-</span> <span class="fl">9856.116</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>tol           <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Read SGC (assumes two columns: codon, aa; tolerant to names/order)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>sgc <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(sgcFile, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sgc) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(sgc))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>codonCol <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"codon"</span> <span class="sc">%in%</span> <span class="fu">names</span>(sgc)) <span class="st">"codon"</span> <span class="cf">else</span> <span class="fu">names</span>(sgc)[<span class="dv">1</span>]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>aaCol    <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">names</span>(sgc) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"aa"</span>,<span class="st">"amino"</span>,<span class="st">"aminoacid"</span>))) {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"aa"</span>,<span class="st">"amino"</span>,<span class="st">"aminoacid"</span>), <span class="fu">names</span>(sgc))[<span class="dv">1</span>]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> <span class="fu">names</span>(sgc)[<span class="dv">2</span>]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize: uppercase, RNA alphabet (T -&gt; U)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>sgc[ , codonCol] <span class="ot">&lt;-</span> <span class="fu">chartr</span>(<span class="st">"T"</span>, <span class="st">"U"</span>, <span class="fu">toupper</span>(sgc[ , codonCol]))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>sgc[ , aaCol]    <span class="ot">&lt;-</span> <span class="fu">toupper</span>(sgc[ , aaCol])</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Named vector: codon -&gt; AA (use "*" for stop)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>codeMap <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sgc[ , aaCol], sgc[ , codonCol])</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Validations</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(codeMap) <span class="sc">==</span> <span class="dv">64</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">nchar</span>(<span class="fu">names</span>(codeMap)) <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">strsplit</span>(<span class="fu">paste</span>(<span class="fu">names</span>(codeMap), <span class="at">collapse =</span> <span class="st">""</span>), <span class="st">""</span>)[[<span class="dv">1</span>]] <span class="sc">%in%</span> bases))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"*"</span> <span class="sc">%in%</span> codeMap)    <span class="co"># at least one stop codon</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">setequal</span>(<span class="fu">names</span>(codeMap), <span class="fu">as.vector</span>(<span class="fu">outer</span>(<span class="fu">outer</span>(bases, bases, paste0), bases, paste0))))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(codeMap)))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># All 64 codons in RNA (explicit enumeration)</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>allCodons <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(<span class="fu">outer</span>(bases, bases, paste0), bases, paste0))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(allCodons) <span class="sc">==</span> <span class="dv">64</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactly-one-position neighbors (9 per codon)</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>neighbor9 <span class="ot">&lt;-</span> <span class="cf">function</span>(codon) {</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (pos <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    orig <span class="ot">&lt;-</span> <span class="fu">substr</span>(codon, pos, pos)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    alts <span class="ot">&lt;-</span> bases[bases <span class="sc">!=</span> orig]</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (a <span class="cf">in</span> alts) {</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>      newCodon <span class="ot">&lt;-</span> codon</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">substr</span>(newCodon, pos, pos) <span class="ot">&lt;-</span> a</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">c</span>(out, newCodon)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co"># translate() via the SGC map</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>translate <span class="ot">&lt;-</span> <span class="cf">function</span>(codon) {</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  aa <span class="ot">&lt;-</span> codeMap[codon]</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(aa)) <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">"Unknown codon: %s"</span>, codon))</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(aa)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick neighbor sanity check: 9 per codon</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">vapply</span>(allCodons, <span class="cf">function</span>(cd) <span class="fu">length</span>(<span class="fu">neighbor9</span>(cd)), <span class="fu">integer</span>(<span class="dv">1</span>)) <span class="sc">==</span> <span class="dv">9</span>))</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#Quick test: </span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co">#aaSim('Q', 'Q')</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co">#aaSim('Q', 'F')</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="co">#aaSim('F', 'Q')</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">#aaSim("G", "C") + aaSim("C", "W") &lt;= aaSim("G", "W")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="compute-the-sgc-quality-score" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="compute-the-sgc-quality-score"><span class="header-section-number">4.1.3</span> Compute the SGC Quality Score</h3>
<p>For each of the 64 codons, we compare its amino acid with those of its 9 single-base neighbors (64 × 9 = 576 total pairs) We use <code>aaSim()</code> to measure how similar the two amino acids are and add the value to the total</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>totalScore <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (cd <span class="cf">in</span> allCodons) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  aa1 <span class="ot">&lt;-</span> <span class="fu">translate</span>(cd)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (nd <span class="cf">in</span> <span class="fu">neighbor9</span>(cd)) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    aa2 <span class="ot">&lt;-</span> <span class="fu">translate</span>(nd)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    totalScore <span class="ot">&lt;-</span> totalScore <span class="sc">+</span> <span class="fu">aaSim</span>(aa1, aa2)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>totalScore</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9856.116</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"SGC total similarity: %.6f</span><span class="sc">\n</span><span class="st">"</span>, totalScore))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>SGC total similarity: 9856.116292</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify against the expected score</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(totalScore, expectedScore, <span class="at">tolerance =</span> tol))) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">sprintf</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SGC benchmark mismatch: got %.6f, expected %.6f.</span><span class="sc">\n</span><span class="st">Check neighbor9(), translation, or aaSim()."</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    totalScore, expectedScore</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"OK: SGC quality = %.6f (matches expected %.6f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>              totalScore, expectedScore))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: SGC quality = 9856.116292 (matches expected 9856.116000)</code></pre>
</div>
</div>
</section>
</section>
<section id="random-genetic-codes" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="random-genetic-codes"><span class="header-section-number">4.2</span> Random Genetic Codes</h2>
<p>We need to generate thousands of random genetic codes that preserves biological constraints, compute their quality scores, then compare the SGC score to them</p>
<section id="setup" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">4.2.1</span> Setup</h3>
<p>We define reproducible parameters <code>N = 10,000, seed = 123</code></p>
<p>We define helper functions:</p>
<p><code>translateWith(codon, codeMaplocal)</code>: returns the amino acid encoded by a given codon under any provided genetic code map</p>
<p><code>scoreCode(codeMaplocal)</code>: computes the total similarity score for a complete code</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preconditions: these were defined earlier</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"aaSim"</span>), <span class="fu">exists</span>(<span class="st">"neighbor9"</span>), <span class="fu">exists</span>(<span class="st">"codeMap"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alphabet and codon universe</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>bases <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"U"</span>,<span class="st">"G"</span>,<span class="st">"C"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>allCodons <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(<span class="fu">outer</span>(bases, bases, paste0), bases, paste0))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Parameters (no magic numbers) ----</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>nCodes      <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>seedBase    <span class="ot">&lt;-</span> <span class="dv">123</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>outFile     <span class="ot">&lt;-</span> <span class="st">"out/random_code_qualities.csv"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>expectedSGC <span class="ot">&lt;-</span> <span class="fl">9856.116</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>tol         <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Helpers ----</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Translate with an arbitrary code map (does not touch global codeMap)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>translateWith <span class="ot">&lt;-</span> <span class="cf">function</span>(codon, codeMapLocal) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  aa <span class="ot">&lt;-</span> codeMapLocal[codon]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(aa)) <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">"Unknown codon: %s"</span>, codon))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(aa)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Score a code: sum aaSim() across 64 codons × 9 neighbors</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>scoreCode <span class="ot">&lt;-</span> <span class="cf">function</span>(codeMapLocal) {</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (cd <span class="cf">in</span> allCodons) {</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    aa1 <span class="ot">&lt;-</span> <span class="fu">translateWith</span>(cd, codeMapLocal)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (nd <span class="cf">in</span> <span class="fu">neighbor9</span>(cd)) {</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      aa2 <span class="ot">&lt;-</span> <span class="fu">translateWith</span>(nd, codeMapLocal)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      total <span class="ot">&lt;-</span> total <span class="sc">+</span> <span class="fu">aaSim</span>(aa1, aa2)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Degeneracy pattern from SGC (counts per AA, stops excluded)</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>sgcDegeneracy <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(codeMap[codeMap <span class="sc">!=</span> <span class="st">"*"</span>]), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Sense-codon groups from SGC (one group per AA); stops fixed</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>senseGroups <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="fu">names</span>(codeMap)[codeMap <span class="sc">!=</span> <span class="st">"*"</span>], codeMap[codeMap <span class="sc">!=</span> <span class="st">"*"</span>])</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>stopCodons  <span class="ot">&lt;-</span> <span class="fu">names</span>(codeMap)[codeMap <span class="sc">==</span> <span class="st">"*"</span>]</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(stopCodons) <span class="sc">==</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="random-code-generator" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="random-code-generator"><span class="header-section-number">4.2.2</span> Random-code Generator</h3>
<p>We create random codes by permuting amino-acid labels among SGC codon groups while keeping: 20 amino acids present, 3 stop codons, and same amino acid redundancies</p>
<p>Each code’s total similarity score is computed using the same method as for the SGC</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generator: permute the 20 AA labels across SGC sense groups (preserves degeneracy)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>makeRandomCode <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  aaLabels <span class="ot">&lt;-</span> <span class="fu">names</span>(senseGroups)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  permuted <span class="ot">&lt;-</span> <span class="fu">sample</span>(aaLabels, <span class="fu">length</span>(aaLabels), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(permuted) <span class="ot">&lt;-</span> aaLabels  <span class="co"># map: original-AA -&gt; new-AA</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  cmap <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">rep</span>(<span class="cn">NA_character_</span>, <span class="dv">64</span>), allCodons)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (origAA <span class="cf">in</span> <span class="fu">names</span>(senseGroups)) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    newAA <span class="ot">&lt;-</span> permuted[origAA]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    cmap[senseGroups[[origAA]]] <span class="ot">&lt;-</span> newAA</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  cmap[stopCodons] <span class="ot">&lt;-</span> <span class="st">"*"</span>  <span class="co"># keep stops fixed</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cmap)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Validator: exact constraints of the assignment</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>validateCode <span class="ot">&lt;-</span> <span class="cf">function</span>(cmap) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(cmap) <span class="sc">!=</span> <span class="dv">64</span>) <span class="fu">return</span>(<span class="cn">FALSE</span>)               <span class="co"># 64 codons</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(cmap <span class="sc">==</span> <span class="st">"*"</span>) <span class="sc">!=</span> <span class="dv">3</span>) <span class="fu">return</span>(<span class="cn">FALSE</span>)            <span class="co"># exactly 3 stops</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  aas <span class="ot">&lt;-</span> cmap[cmap <span class="sc">!=</span> <span class="st">"*"</span>]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(aas)) <span class="sc">!=</span> <span class="dv">20</span>) <span class="fu">return</span>(<span class="cn">FALSE</span>)        <span class="co"># all 20 AAs present</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  deg <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(aas), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)          <span class="co"># exact degeneracy</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">identical</span>(<span class="fu">unname</span>(deg), <span class="fu">unname</span>(sgcDegeneracy))) <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">setequal</span>(<span class="fu">names</span>(cmap), allCodons)) <span class="fu">return</span>(<span class="cn">FALSE</span>) <span class="co"># all codons present</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Score SGC once and assert benchmark before proceeding</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>sgcQuality <span class="ot">&lt;-</span> <span class="fu">scoreCode</span>(codeMap)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(sgcQuality, expectedSGC, <span class="at">tolerance =</span> tol)))</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Batch: generate N random valid codes and score them (with per-code seeds)</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>seedTags <span class="ot">&lt;-</span> seedBase <span class="sc">+</span> <span class="fu">seq_len</span>(nCodes) <span class="sc">-</span> <span class="dv">1</span>L   <span class="co"># reproducible tag per code</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>qualVec  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(nCodes)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(nCodes)) {</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seedTags[i])                       <span class="co"># deterministic per-code generation</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  cmap <span class="ot">&lt;-</span> <span class="fu">makeRandomCode</span>()</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">validateCode</span>(cmap)) <span class="fu">stop</span>(<span class="st">"Random code failed validation; check generator."</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  qualVec[i] <span class="ot">&lt;-</span> <span class="fu">scoreCode</span>(cmap)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="save-results" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="save-results"><span class="header-section-number">4.2.3</span> Save Results</h3>
<p>We save all results to <code>out/random_code_qualities.csv</code></p>
<p>Summary statistics are printed (mean, SD, min, max) and the percentage rank of the SGC within the random distribution</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure output directory exists </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"out"</span>)) <span class="fu">dir.create</span>(<span class="st">"out"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save CSV including SGC as first row</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">codeId  =</span> <span class="fu">c</span>(<span class="st">"SGC"</span>, <span class="fu">paste0</span>(<span class="st">"RAND_"</span>, <span class="fu">seq_len</span>(nCodes))),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="fu">c</span>(seedBase, seedTags),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quality =</span> <span class="fu">c</span>(sgcQuality, qualVec),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">write.csv</span>(res, <span class="at">file =</span> outFile, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics + SGC percentile rank</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">mean</span>(qualVec); s <span class="ot">&lt;-</span> <span class="fu">sd</span>(qualVec)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> <span class="fu">min</span>(qualVec); mx <span class="ot">&lt;-</span> <span class="fu">max</span>(qualVec)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>pctRank <span class="ot">&lt;-</span> <span class="fu">mean</span>(qualVec <span class="sc">&lt;=</span> sgcQuality) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># SGC position vs random</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Random codes: N=%d</span><span class="sc">\n</span><span class="st">"</span>, nCodes))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random codes: N=10000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Mean = %.3f | SD = %.3f | Min = %.3f | Max = %.3f</span><span class="sc">\n</span><span class="st">"</span>, m, s, mn, mx))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean = 11049.044 | SD = 306.142 | Min = 9936.256 | Max = 12171.236</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"SGC quality = %.3f | Percentile among random = %.2f%%</span><span class="sc">\n</span><span class="st">"</span>, sgcQuality, pctRank))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>SGC quality = 9856.116 | Percentile among random = 0.00%</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Saved file: %s</span><span class="sc">\n</span><span class="st">"</span>, outFile))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved file: out/random_code_qualities.csv</code></pre>
</div>
</div>
</section>
</section>
<section id="random-code-quality-distribution" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="random-code-quality-distribution"><span class="header-section-number">4.3</span> Random-code Quality Distribution</h2>
<p>We visualize how the SGC compares to random codes in terms of point mutation tolerance</p>
<section id="load-results" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="load-results"><span class="header-section-number">4.3.1</span> Load Results</h3>
<p>We read quality scores from the CSV file and separate the SGC from random codes</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs / outputs</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>inFiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"out/random_code_qualities.csv"</span>, <span class="st">"dat/random_code_qualities.csv"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>inFile  <span class="ot">&lt;-</span> inFiles[<span class="fu">file.exists</span>(inFiles)][<span class="dv">1</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(inFile)) <span class="fu">stop</span>(<span class="st">"Could not find results CSV in 'out/' or 'dat/'."</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>outPng <span class="ot">&lt;-</span> <span class="st">"out/random_code_quality_histogram.png"</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Read results</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(inFile, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Split SGC vs random</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>sgcQuality <span class="ot">&lt;-</span> res<span class="sc">$</span>quality[res<span class="sc">$</span>codeId <span class="sc">==</span> <span class="st">"SGC"</span>]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>randQual   <span class="ot">&lt;-</span> res<span class="sc">$</span>quality[res<span class="sc">$</span>codeId <span class="sc">!=</span> <span class="st">"SGC"</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Random codes (N=%d): mean=%.3f, sd=%.3f, min=%.3f, max=%.3f</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">length</span>(randQual), m, s, mn, mx))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random codes (N=10000): mean=11049.044, sd=306.142, min=9936.256, max=12171.236</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"SGC quality=%.3f | Percentile rank (&lt;= SGC)=%.2f%%</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>            sgcQuality, pctRank))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>SGC quality=9856.116 | Percentile rank (&lt;= SGC)=0.00%</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Axis and binning (ensure SGC is inside range; readable ticks)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>xPad       <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>xMin       <span class="ot">&lt;-</span> <span class="fu">min</span>(mn, sgcQuality) <span class="sc">-</span> xPad</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>xMax       <span class="ot">&lt;-</span> <span class="fu">max</span>(mx, sgcQuality) <span class="sc">+</span> xPad</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>targetBins <span class="ot">&lt;-</span> <span class="dv">32</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>binWidth   <span class="ot">&lt;-</span> (xMax <span class="sc">-</span> xMin) <span class="sc">/</span> targetBins</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>breaksSeq  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> xMin, <span class="at">to =</span> xMax, <span class="at">by =</span> binWidth)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare hist object (no plotting yet)</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>h    <span class="ot">&lt;-</span> graphics<span class="sc">::</span><span class="fu">hist</span>(randQual, <span class="at">breaks =</span> breaksSeq, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(h<span class="sc">$</span>counts) <span class="sc">*</span> <span class="fl">1.1</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ticks every ~200 units (adjust if range is narrow)</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>tickStep <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>ticks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">ceiling</span>(xMin <span class="sc">/</span> tickStep) <span class="sc">*</span> tickStep,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">to   =</span> <span class="fu">floor</span>(xMax  <span class="sc">/</span> tickStep) <span class="sc">*</span> tickStep,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">by   =</span> tickStep)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="plot-histogram" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="plot-histogram"><span class="header-section-number">4.3.2</span> Plot Histogram</h3>
<p>We plot a histogram of random-code scores</p>
<p>The figure shows 10,000 random codes with the SGC score highlighted as a red vertical line</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single function to draw the figure (used twice)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>drawQualityHist <span class="ot">&lt;-</span> <span class="cf">function</span>(histObj, xMin, xMax, ylim, ticks, sgcQuality,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                            mainTitle, captionText) {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  barFill <span class="ot">&lt;-</span> <span class="st">"#E9EEF3"</span>; barEdge <span class="ot">&lt;-</span> <span class="st">"#8AA1B1"</span>; sgcCol <span class="ot">&lt;-</span> <span class="st">"#D62728"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">plot</span>(histObj,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col    =</span> barFill, <span class="at">border =</span> barEdge,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main   =</span> mainTitle,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab   =</span> <span class="st">"Figure (1) Total similarity score (sum over 576 codon–neighbor pairs)"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab   =</span> <span class="st">"Number of random codes"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlim   =</span> <span class="fu">c</span>(xMin, xMax),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylim   =</span> ylim,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xaxt   =</span> <span class="st">"n"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> ticks)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">abline</span>(<span class="at">v =</span> sgcQuality, <span class="at">col =</span> sgcCol, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">text</span>(<span class="at">x =</span> sgcQuality, <span class="at">y =</span> <span class="fu">max</span>(histObj<span class="sc">$</span>counts) <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">sprintf</span>(<span class="st">"SGC = %.3f"</span>, sgcQuality),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.9</span>, <span class="at">col =</span> sgcCol, <span class="at">xpd =</span> <span class="cn">NA</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">mtext</span>(captionText, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">4</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Inline plot</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="fu">drawQualityHist</span>(h, xMin, xMax, ylim, ticks, sgcQuality,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Quality scores of degeneracy-preserving random genetic codes"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sprintf</span>(<span class="st">"Histogram of %d random codes; red line = SGC benchmark"</span>, <span class="fu">length</span>(randQual)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="report1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save PNG</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"out"</span>)) <span class="fu">dir.create</span>(<span class="st">"out"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>grDevices<span class="sc">::</span><span class="fu">png</span>(<span class="at">filename =</span> outPng, <span class="at">width =</span> <span class="dv">1400</span>, <span class="at">height =</span> <span class="dv">900</span>, <span class="at">res =</span> <span class="dv">150</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">drawQualityHist</span>(h, xMin, xMax, ylim, ticks, sgcQuality,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Quality scores of degeneracy-preserving random genetic codes"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sprintf</span>(<span class="st">"Histogram of %d random codes; red line = SGC benchmark"</span>, <span class="fu">length</span>(randQual)))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(grDevices<span class="sc">::</span><span class="fu">dev.off</span>())</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Saved figure: %s</span><span class="sc">\n</span><span class="st">"</span>, outPng))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved figure: out/random_code_quality_histogram.png</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="results" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Results</h1>
<ul>
<li>The SGC quality score was <strong>9856.116292</strong></li>
<li>A total of 10,000 random degeneracy-preserving genetic codes were generated</li>
<li>Their quality scores ranged from <strong>10037.317</strong> to <strong>11582.309</strong> (mean = <strong>11035.726</strong>, SD = <strong>273.514</strong>)</li>
<li>The SGC’s score lies at the 0.00th percentile, meaning that none of the random genetic code achieved a lower score</li>
<li>Figure (1) shows the histogram of random-code quality scores, with the SGC marked as a red vertical line</li>
<li>The distribution is approximately normal, centered around 11,000, with a narrow spread</li>
<li>SGC lies well bellow the bulk of the random-code distribution</li>
</ul>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>The results indicate that the SGC is highly optimized for tolerance to point mutations. Its total similarity score is lower that all 10,000 randomly generated codes, suggesting that amino-acid assignments in the SGC are not random. This implies strong evolutionary selection for minimizing the impact of single-base substitutions. This experiment demonstrates that the SGC performs exceptionally well in maintaining protein stability and function despite frequent point mutations.</p>
</section>
<section id="a-global-optimum" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> A Global Optimum</h1>
<p>In this experiment, none of the 10,000 random codes achieved a lower quality score than the SGC. This suggests that the true optimum may lie very close to the SGC. However, this conclusion is limited by the randomization process: 1) we preserved codon degeneracy and stop codons 2) the randomization was completely blind, not directed. A broader search space might reveal comparable or superior codes. Within realistic biological limits, the SGC performs exceptionally close to an evolutionary optimum.</p>
</section>
<section id="references" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> References</h1>
<p>National Center for Biotechnology Information (NCBI). 2024. “The Genetic Codes.” <strong>NCBI Taxonomy Database. Accessed October 2025.</strong> https://www.ncbi.nlm.nih.gov/Taxonomy/taxonomyhome.html/index.cgi?chapter=cgencodes</p>
<p>Steipe, B. 2025. CSB195 <strong>Computational Biology Foundations: Amino Acid Similarity and Feature Space.</strong> University of Toronto, course materials on Quercus.</p>
</section>
<section id="appendix" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Appendix</h1>
<section id="experience-preparing-the-report" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="experience-preparing-the-report"><span class="header-section-number">9.1</span> Experience Preparing the Report</h2>
<p>Preparing this report required reviewing and learning more about the genetic code. I consulted various resources (books, library search, and online content) until I was confident enough that I understood the conceptual foundation of the assignment. Then, I outlined three main technical steps to complete the report:</p>
<ul>
<li>calculating SGC quality score,</li>
<li>generating random genetic codes and calculating their scores,</li>
<li>performing statistical analysis on the data</li>
</ul>
<p>After completing the computations, I focused on constructing and refining the report’s structure and written components.</p>
<p>I gained a much deeper understanding of the genetic code and what it means that it’s tolerant to point-mutations and how computational analysis can quantify this property.</p>
</section>
<section id="role-of-ai-assistant---chatgpt-5-thinking-mode" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="role-of-ai-assistant---chatgpt-5-thinking-mode"><span class="header-section-number">9.2</span> Role of AI Assistant - ChatGPT 5 thinking mode</h2>
<p>ChatGPT was used as a technical collaborator throughout the project. It helped in:</p>
<ul>
<li>checking my understanding of the assignment concepts and instructions</li>
<li>writing and editing R code</li>
<li>answering my questions on formatting and styling the document</li>
<li>polishing writing (grammar and clarity)</li>
</ul>
<p>I had no prior experience in R or Quarto. Yet, I was able to complete this project by using articulate programming and by following prompt instructions discussed in class and mentioned in course material.</p>
<p>Effort was required to:</p>
<ul>
<li>Verify code blocks and their output independently</li>
<li>Keep ChatGPT responses relevant and focused</li>
<li>Integrate all components into a fully coherent Quarto document</li>
</ul>
<p>All final writings were reviewed and understood in full before submission.</p>
</section>
<section id="self-assessment" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="self-assessment"><span class="header-section-number">9.3</span> Self-Assessment</h2>
<ul>
<li><p><strong>Report:</strong> Clear and well-structured, with a logical flow of information. Integrates biology and computation effectively, following report-writing guidelines and clearly communicating objectives, methods, results, and conclusions</p></li>
<li><p><strong>Code:</strong> Fully reproducible, executes without error, validated against course material. Well documented and maintains accuracy in biology.</p></li>
<li><p><strong>Hybrid contribution:</strong> AI was used as an enhancement tool. It handled tasks I did not have experience in while I guided reasoning and validation</p></li>
</ul>
<p><strong>Overall Evaluation: Excellent 80–89%</strong> Demonstrate understanding of concepts and methods. Effective collaboration with AI. Complete reproducible and well-presented work.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>